<app-breadcrumb></app-breadcrumb>
<div class="container">
  <h4 class="page-title">Contact group</h4>
  <form action="">
    <h5>People</h5>
    <div class="list-group mb-3">
      <div class="list-group-item" *ngIf="!contactGroupDetails?.contactPeople">
        <div class="text-center">
          <i class="fas fa-spinner fa-pulse d-inline-block"></i> Loading contacts ...
        </div>
      </div>
      <a [routerLink]="['../../../../detail', person.personId ]" class="list-group-item list-group-item-action" *ngFor="let person of contactGroupDetails?.contactPeople; index as i">
        <div class="row">
          <div class="col-12 text-right">
            <div dropdown placement="bottom right">
              <a class="dropdown-toggle" href [id]="'button' + i" dropdownToggle (click)="$event.stopPropagation(); false"
              [attr.aria-controls]="'dropdown' + i">Actions <span class="caret"></span></a>
                  <ul [id]="'dropdown' + i" *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu" [attr.aria-labelledby]="'button' + i">
                    <li role="menuitem"><a class="dropdown-item" (click)="$event.stopPropagation();"
                      [routerLink]="['../../edit']"  [queryParams]="{groupPersonId: person.personId }" ><i class="fas fa-edit"></i> Edit</a></li>
                    <li role="menuitem"><a class="dropdown-item" href (click)="removePerson($event, person.personId)"><i class="fas fa-user-times"></i> Remove</a></li>
                  </ul>
            </div>
          </div>
          <div class="col-12 mb-2">
            <strong>{{person.firstName}} {{person.lastName}}</strong>&nbsp;
              <ng-container *ngIf="contactGroupDetails.contactType === 4">&nbsp;
                  <span class="badge badge-pill badge-info">{{contactGroupDetails?.companyName}}</span>
              </ng-container>
            <!-- <i class="fas fa-phone"></i>&nbsp;

            <i class="fas fa-envelope"></i>&nbsp;

            <span class="badge badge-success">AML Valid</span> -->
          </div>
          <div class="col-sm-4 mb-2">{{person.address | formatAddress}}<span class="text-muted" *ngIf="!(person.address | formatAddress)">No address</span></div>
          <div class="col-sm-3 col-xl-4">
            <div class="row">
              <div class="col-6 telephone">
                <p class="mb-2 text-muted" *ngIf="!person.phoneNumbers.length">No phone</p>
                <p class="mb-2" *ngFor="let phoneNumber of person.phoneNumbers"><a (click)="$event.stopPropagation()" href="tel:{{phoneNumber.number}}">{{phoneNumber?.number}}</a><br />{{phoneNumber?.telephoneId}}</p>
              </div>
            </div>
          </div>
          <div class="col-sm-5 col-xl-4">
            <p class="mb-2 text-muted" *ngIf="!person.emailAddresses.length">No email</p>
            <p class="mb-2" *ngFor="let emailAddress of person.emailAddresses"><a (click)="$event.stopPropagation()" href="mailto:{{emailAddress.email}}">{{emailAddress.email}}</a></p>
          </div>
          <div class="col-12">
            <hr class="my-1">
          </div>
          <div class="col-12">
            <a href class="btn btn-link px-0" (click)="showHideMarkPrefs($event, i)"
              [attr.aria-expanded]="!isCollapsed[i]" [attr.aria-controls]="'collapseMark' + i">Marketing Prefs <span
                class="badge badge-pill badge-primary">{{person.marketingPreferences?.count || 0}}</span>
            </a>
            <div [id]="'collapseMark' + i" [collapse]="!isCollapsed[i]">
              <ul>
                  <li *ngIf="person.marketingPreferences?.marketBulletin">Quarterly bulletin</li>
                  <li *ngIf="person.marketingPreferences?.general" >Special offers</li>
                  <li *ngIf="person.marketingPreferences?.events">Landlord/investor events</li>
                  <li *ngIf="person.marketingPreferences?.newHomes">New homes/investments</li>
                  <li *ngIf="person.marketingPreferences?.general">Other occasional marketing</li>
              </ul>
            </div>
          </div>
        </div>
      </a>
      <a href (click)="showHideOffCanvas($event)" class="list-group-item list-group-item-action text-center py-4">
        <span class="btn-link">
          <i class="fas fa-user-plus"></i> Add Person
        </span>
      </a>
    </div>
    <h5>Details</h5>
   <form [formGroup]="contactGroupDetailsForm">
      <div class="form-group row">
        <label for="salutation" class="col-sm-2 col-form-label col-form-label-sm">Salutation</label>
        <div class="col-sm-10">
          <input type="text" id="salutation" class="form-control form-control-sm" formControlName="salutation">
        </div>
      </div>
      <div class="form-group row">
        <label for="addressee" class="col-sm-2 col-form-label col-form-label-sm">Addressee</label>
        <div class="col-sm-10">
          <input type="text" id="addressee" class="form-control form-control-sm" formControlName="addressee">
        </div>
      </div>
      <div class="form-group row">
        <label for="comments" class="col-sm-2 col-form-label col-form-label-sm">Comments</label>
        <div class="col-sm-10">
          <textarea id="comments" class="form-control form-control-sm" formControlName="comments"></textarea>
        </div>
      </div>
   </form>
    <div class="row mt-3 justify-content-end">
      <div class="col-sm-10">
        <div class="row">
          <div class="form-group col-sm-auto">
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input" id="relAgent">
              <label class="custom-control-label" for="relAgent">Is Relocation Agent</label>
            </div>
          </div>
          <div class="form-group col type-col">
            <div class="custom-control custom-radio custom-control-inline">
              <input type="radio" id="individual" name="type" class="custom-control-input">
              <label class="custom-control-label" for="individual">Individual/Joint</label>
            </div>
            <div class="custom-control custom-radio custom-control-inline">
              <input type="radio" id="multi" name="type" class="custom-control-input">
              <label class="custom-control-label" for="multi">Multi/Shares</label>
            </div>
            <div class="custom-control custom-radio custom-control-inline">
              <input type="radio" id="company" name="type" class="custom-control-input">
              <label class="custom-control-label" for="company">Company contact</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="form-actions">
      <div class="container px-lg-4">
        <div class="row justify-content-end w-100 no-gutters">
          <div class="col-sm-10 d-flex">
            <button type="button" class="btn btn-light mr-2">Cancel</button>
            <button routerLink="/contact-centre" type="submit" class="btn btn-secondary">Edit contact group</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
<div class="off-canvas" [hidden]="!isOffCanvasVisible" (click)="showHideOffCanvas($event)">
  <div class="off-canvas-content right slide-in-right" (click)="$event.stopPropagation()">
    <h4 class="page-title text-left">
      Find person
      <button type="button" class="close mr-2" aria-label="Close" (click)="showHideOffCanvas($event)">
        <span aria-hidden="true">&times;</span>
      </button>
    </h4>
    <ng-container *ngIf="!foundPersonId; else editPerson">
        <form [formGroup]="personFinderForm">
            <div class="form-group row">
              <label for="firstName" class="col-sm-2 col-form-label col-form-label-sm">First Name</label>
              <div class="col-sm-10">
                <input type="text" id="firstName" class="form-control form-control-sm" autofocus formControlName="firstName">
              </div>
            </div>
            <div class="form-group row">
              <label for="lastName" class="col-sm-2 col-form-label col-form-label-sm">Last Name</label>
              <div class="col-sm-10">
                <input type="text" id="lastName" class="form-control form-control-sm" formControlName="lastName">
              </div>
            </div>
            <div class="form-group row">
              <label for="phone" class="col-sm-2 col-form-label col-form-label-sm">Phone</label>
              <div class="col-sm-10">
                <div class="input-group input-group-sm">
                  <select name="type" id="type" class="custom-select">
                    <option value="">Mobile</option>
                  </select>
                  <input type="text" id="phone" class="form-control" formControlName="phoneNumber">
                </div>
              </div>
            </div>
            <div class="form-group row">
              <label for="email" class="col-sm-2 col-form-label col-form-label-sm">Email</label>
              <div class="col-sm-10">
                <input type="text" id="email" class="form-control form-control-sm" formControlName="emailAddress">
              </div>
            </div>
        </form>
        <div class="form-group row justify-content-end">
              <div class="col-sm-10">
                <div class="row">
                  <div class="col">
                    <h5>Quick Finder</h5>
                  </div>
                  <div class="col-auto d-none d-sm-block">
                      <!-- TODO Get colours -->
                      <span class="badge badge-success mr-1">Part Match</span>
                      <span class="badge badge-success mr-1">Good Match</span>
                      <span class="badge badge-success">Full Match</span>
                  </div>
                </div>
                <div class="list-group small">
                  <div class="list-group-item list-header d-none d-sm-block">
                    <div class="row">
                      <div class="col-sm"><strong>Full Name</strong></div>
                      <div class="col-sm"><strong>Email</strong></div>
                      <div class="col-sm"><strong>Telephone</strong></div>
                      <div class="col-sm col-lg-2"></div>
                    </div>
                  </div>
                  <div class="list-group-item"  *ngFor="let foundPerson of foundPeople">
                    <div class="row align-items-end align-items-sm-center">
                      <div class="col d-sm-none">
                        <h6><span class="badge badge-success">Full Match</span></h6>
                      </div>
                      <div class="col-sm">
                        <dl class="row">
                          <dt class="col-4 d-sm-none">Full Name</dt>
                          <dd class="col">{{foundPerson.fullName}}</dd>
                        </dl>
                      </div>
                      <div class="col-sm">
                        <dl class="row">
                          <dt class="col-4 d-sm-none">Email</dt>
                        <ng-container *ngFor="let email of foundPerson.emailAddresses">
                          <dd class="col">{{email}}</dd>
                        </ng-container>
                        </dl>
                      </div>
                      <div class="col-sm">
                        <dl class="row">
                          <dt class="col-4 d-sm-none">Telephone</dt>
                          <ng-container *ngFor="let phoneNumber of foundPerson.phoneNumbers">
                            <dd class="col">{{phoneNumber}}</dd>
                        </ng-container>
                        </dl>
                      </div>
                      <div class="col-sm col-lg-2">
                        <button class="btn btn-block btn-sm btn-primary"
                        (click)="selectPerson(foundPerson.personId)">Select</button>
                      </div>
                      <!-- <div class="col-sm col-lg-2">
                        <button class="btn btn-block btn-sm btn-primary" [routerLink]="['../../edit']"
                        [queryParams]="{foundPersonId:foundPerson.personId, contactGroupId:contactGroupDetails.contactGroupId}"
                        (click)="selectPerson(foundPerson.personId)">Select</button>
                      </div> -->
                    </div>
                  </div>
                  <!-- TODO Show only if you have name, last name and phone/email -->
                  <a href class="list-group-item list-group-item-action text-center py-4">
                    <span class="btn-link">
                      <i class="fas fa-user-plus"></i> Create New Person
                    </span>
                  </a>
                </div>
              </div>
        </div>
    </ng-container>
      <ng-template #editPerson>
      <app-contactgroups-detail-edit></app-contactgroups-detail-edit>
      </ng-template>
  </div>
</div>

