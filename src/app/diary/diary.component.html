<div class="row no-gutters justify-content-between mb-3 diary-header">
  <div class="col-auto">
    <div class="row no-gutters align-items-center">
      <div class="col-auto">
        <div class="btn-group mr-2" dropdown [dropup]="isDropup" (window:resize)="setDropup()">
          <button id="button-dropup" dropdownToggle type="button" class="btn btn-secondary rounded"
            aria-controls="event-dropup">
            <i class="fas fa-plus"></i> <span class="d-none d-sm-inline ml-2">Add Event</span>
          </button>
          <ul id="event-dropup" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-dropup">
            <li role="menuitem"><a class="dropdown-item" [routerLink]="['/add-event']"><i
                  class="fas fa-calendar-day fa-fw mr-2"></i>Appointment</a></li>
            <li role="menuitem"><a class="dropdown-item" href="#"><i class="fas fa-phone fa-fw mr-2"></i>Callback
                reminder</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-auto d-sm-none" *ngIf="viewMode == 'day'" >
          <button type="button" class="btn btn-link px-0" (click)="enterView('','month')"><i class="fas fa-chevron-left"></i> {{monthLabel}}</button>
      </div>
      <div class="col-auto d-sm-block pr-2" *ngIf="!appUtils.isDiarySearchVisible" [ngClass]="{'d-none': viewMode == 'day'}">
        <button type="button" class="btn btn-light" (click)="setToday()">{{setTodayLabel}}</button>
      </div>
      <div class="col d-sm-block" *ngIf="!appUtils.isDiarySearchVisible" [ngClass]="{'d-none': viewMode == 'day'}">
        <button type="button" class="btn btn-light" (click)="prevMonth()"><i class="fas fa-chevron-left"></i></button>
        <h6 class="d-inline-block m-0 align-middle mx-2">{{monthLabel}}</h6>
        <button type="button" class="btn btn-light" (click)="nextMonth()"><i class="fas fa-chevron-right"></i></button>
      </div>
    </div>
  </div>
  <div class="col-auto d-sm-block" [ngClass]="{'d-none': viewMode == 'day'}">
    <div class="row no-gutters">
      <div class="col-auto">
        <button type="button" (click)="toggleSearch()" class="btn btn-light">
          <ng-container *ngIf="!appUtils.isDiarySearchVisible"><i class="fas fa-search fa-fw"></i> <span class="d-none d-sm-inline ml-2">Search</span></ng-container><ng-container *ngIf="appUtils.isDiarySearchVisible"><i class="fas fa-calendar-alt fa-fw mr-2"></i> Calendar</ng-container></button>
      </div>
      <div class="col d-none d-sm-flex pl-2" *ngIf="!appUtils.isDiarySearchVisible">
        <select name="viewMode" id="vew-mode" [(ngModel)]="viewMode" (ngModelChange)="changeView()"
          class="custom-select">
          <option value="day">Day</option>
          <option value="week">Week</option>
          <option value="month">Month</option>
        </select>
      </div>
    </div>
  </div>
</div>

<div class="container p-0 search" *ngIf="appUtils.isDiarySearchVisible">
  <div class="form-group">
    <input type="text" class="form-control" placeholder="Search event" autofocus>
  </div>
  <div class="card-grid mt-0 month">
    <div class="card">
      <div class="card-header">
        <strong>Sat 30 Mar</strong>
      </div>
      <div class="card-body">
        <div class="row no-gutters event">
          <span class="color" [ngStyle]="{'background': 'blue'}"></span>
          <div class="col text-truncate"><span class="text-muted">00.00</span> Searched event</div>
          <div class="col-auto"><i class="fas fa-calendar fa-fw"></i></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card-grid {{viewMode}}" *ngIf="!appUtils.isDiarySearchVisible">
  <div class="card" *ngFor="let day of days; first as isFirst" class="{{day.spanClass}}"
    [ngClass]="{'is-weekend': day.isWeekend, 'no-events': !day.events.length && viewMode != 'day', 'is-today': day.isToday }"
    [attr.id]="day.isToday ? 'today' : ''">
    <div class="card-header clearfix" (click)="enterView(day.date, 'day')">
      <strong [ngClass]="{'text-secondary': day.isToday}">{{day.label}}</strong>
    </div>

    <ng-template #popTemplate>
      <ul class="list-unstyled m-0" tabindex="1">
        <li><a class="dropdown-item" [routerLink]="['/add-event']"><i
              class="fas fa-calendar-day fa-fw mr-2"></i>Add Appointment</a></li>
        <li><a class="dropdown-item" href="#"><i class="fas fa-phone fa-fw mr-2"></i>Add Callback
            reminder</a>
        </li>
      </ul>
    </ng-template>
    <div class="card-body" [ngClass]="{'pl-2 pl-lg-1': viewMode !== 'month'}" [popover]="popTemplate" [containerClass]="day.isClickable && viewMode === 'month' ? '' : 'd-none'" [outsideClick]="true">
      <div class="day-grid" *ngIf="viewMode !== 'month'">
        <div class="border-bottom hour-00" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '00:00' : ''}}</div>
        <div class="border-bottom hour-01" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '01:00' : ''}}</div>
        <div class="border-bottom hour-02" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '02:00' : ''}}</div>
        <div class="border-bottom hour-03" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '03:00' : ''}}</div>
        <div class="border-bottom hour-04" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '04:00' : ''}}</div>
        <div class="border-bottom hour-05" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '05:00' : ''}}</div>
        <div class="border-bottom hour-06" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '06:00' : ''}}</div>
        <div class="border-bottom hour-07" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '07:00' : ''}}</div>
        <div class="border-bottom hour-08" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '08:00' : ''}}</div>
        <div class="border-bottom hour-09" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '09:00' : ''}}</div>
        <div class="border-bottom hour-10" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '10:00' : ''}}</div>
        <div class="border-bottom hour-11" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '11:00' : ''}}</div>
        <div class="border-bottom hour-12" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '12:00' : ''}}</div>
        <div class="border-bottom hour-13" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '13:00' : ''}}</div>
        <div class="border-bottom hour-14" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '14:00' : ''}}</div>
        <div class="border-bottom hour-15" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '15:00' : ''}}</div>
        <div class="border-bottom hour-16" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '16:00' : ''}}</div>
        <div class="border-bottom hour-17" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '17:00' : ''}}</div>
        <div class="border-bottom hour-18" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '18:00' : ''}}</div>
        <div class="border-bottom hour-19" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '19:00' : ''}}</div>
        <div class="border-bottom hour-20" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '20:00' : ''}}</div>
        <div class="border-bottom hour-21" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '21:00' : ''}}</div>
        <div class="border-bottom hour-22" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '22:00' : ''}}</div>
        <div class="hour-23" (click)="$event.stopPropagation()" [ngClass]="{'clickable': day.isClickable}" container="body" [popover]="popTemplate" [containerClass]="day.isClickable ? '' : 'd-none'">{{isFirst ? '23:00' : ''}}</div>
      </div>
      <div class="row no-gutters event" [tooltip]="event.title" [ngClass]="{'mb-2': !isLast}" [ngStyle]="{'background-color': event.color, 'height': event.duration, 'top': event.position}" *ngFor="let event of day?.events; last as isLast">
        <span class="color" [ngStyle]="{'background': event.color}" *ngIf="viewMode === 'month'"></span>
        <div class="col text-truncate"><span [ngClass]="{'text-muted': viewMode === 'month'}">{{event.time}}</span> {{event.title}}</div>
        <div class="col-auto" [ngClass]="{'text-muted': viewMode === 'month'}"><i class="far fa-calendar fa-fw" *ngIf="event.type"></i><i class="fas fa-phone fa-fw"
            *ngIf="!event.type"></i></div>
      </div>
    </div>
  </div>
</div>